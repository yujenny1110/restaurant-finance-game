<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>餐廳財務報表決策遊戲</title>
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      padding: 20px;
      background: #f3f4f6;
      color: #111827;
    }

    h1, h2, h3 {
      margin: 0 0 10px;
      font-weight: 600;
    }

    .container {
      max-width: 1100px;
      margin: 0 auto;
    }

    .card {
      background: #ffffff;
      border-radius: 16px;
      padding: 16px 20px;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.08);
      margin-bottom: 16px;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-bottom: 10px;
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 8px 16px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      background: #2563eb;
      color: white;
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
      transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.15s ease;
      white-space: nowrap;
    }

    .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(37, 99, 235, 0.5);
      background: #1d4ed8;
    }

    .btn.secondary {
      background: #e5e7eb;
      color: #374151;
      box-shadow: none;
    }

    .layout {
      display: grid;
      grid-template-columns: 2fr 1.3fr;
      gap: 16px;
    }

    @media (max-width: 900px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    th, td {
      padding: 4px 8px;
      border-bottom: 1px solid #e5e7eb;
      text-align: right;
    }

    th:first-child,
    td:first-child {
      text-align: left;
    }

    th {
      background: #f9fafb;
      font-weight: 600;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      background: #eff6ff;
      color: #1d4ed8;
      margin-left: 6px;
    }

    .pill.bad {
      background: #fef2f2;
      color: #b91c1c;
    }

    .pill.neutral {
      background: #f3f4f6;
      color: #4b5563;
    }

    .muted {
      color: #6b7280;
      font-size: 12px;
    }

    .metric-tag {
      padding: 4px 8px;
      border-radius: 999px;
      background: #f3f4f6;
      margin-right: 8px;
      margin-top: 6px;
      font-size: 12px;
      display: inline-block;
    }

    select {
      width: 100%;
      padding: 6px 8px;
      margin-top: 4px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      font-size: 13px;
      background: #fff;
    }

    label {
      font-size: 13px;
    }
  </style>
</head>

<body>
<div class="container">

  <div class="card">
    <div class="header">
      <div>
        <h1>餐廳財務報表決策遊戲</h1>
        <div class="muted">
          以餐廳為例：單價 = 平均客單價、銷量 = 來客數。<br>
          固定第 1 期 → 第 2 期隨機情境 → 選擇決策 → 檢視第 3 期損益表。
        </div>
      </div>
      <button class="btn" id="btn-new">重新產生第 2 期情境</button>
    </div>
  </div>

  <div class="layout">

    <!-- 左側：損益表 -->
    <div class="card">
      <h2>餐廳損益表</h2>

      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
        <div>
          <div class="pill">第 1 期（固定基準）</div>
          <table id="table-p1"></table>
        </div>

        <div>
          <div class="pill neutral" id="p2-tag">第 2 期（隨機情境）</div>
          <table id="table-p2"></table>
        </div>
      </div>

      <div style="margin-top: 20px;">
        <div class="pill neutral" id="p3-tag">第 3 期（尚未決策）</div>
        <table id="table-p3"></table>
      </div>
    </div>

    <!-- 右側：決策 -->
    <div class="card">
      <h2>經營決策（以第 2 期為出發點）</h2>

      <div style="margin-bottom: 10px;" class="muted">
        想像你是餐廳經營者，請設定下期（第 3 期）要採取的策略。
      </div>

      <div style="margin-bottom: 10px;">
        <label>1. 客單價（售價）</label>
        <select id="sel-price">
          <option value="none">不調整</option>
          <option value="up">調高 10%</option>
          <option value="down">調降 10%（打折促銷）</option>
        </select>
      </div>

      <div style="margin-bottom: 10px;">
        <label>2. 行銷預算（廣告 / 外送平台曝光）</label>
        <select id="sel-ad">
          <option value="none">不調整</option>
          <option value="up">提高 20%</option>
          <option value="down">降低 20%</option>
        </select>
      </div>

      <div style="margin-bottom: 8px;">
        <label>
          <input type="checkbox" id="chk-cost">
          3. 成本改善專案：與供應商談判、優化菜單（變動成本 -5%，但需顧問費 20,000）
        </label>
      </div>

      <div style="margin-bottom: 12px;">
        <label>
          <input type="checkbox" id="chk-admin">
          4. 精簡管理與人力：管理費 -15%，但服務品質下降，來客數 -15%
        </label>
      </div>

      <div style="margin-bottom: 16px;">
        <button class="btn" id="btn-run">執行決策</button>
        <button class="btn secondary" id="btn-clear">清除第 3 期結果</button>
      </div>

      <h3>決策成效</h3>
      <div id="result" class="muted">尚未執行決策。</div>
      <div id="metrics"></div>
    </div>

  </div>
</div>


<!-- JS 程式區 -->
<script>
// ===== 損益表類別 =====
class Period {
  constructor(price, volume, varCost, fixedMfg, ad, admin, interest, taxRate = 0.2) {
    this.price = price;      // 客單價
    this.volume = volume;    // 來客數
    this.varCost = varCost;  // 每位客人變動成本
    this.fixedMfg = fixedMfg;// 固定成本（房租、水電、底薪）
    this.ad = ad;            // 行銷費
    this.admin = admin;      // 管理費
    this.interest = interest;// 利息
    this.taxRate = taxRate;
    this.calc();
  }

  calc() {
    this.revenue = this.price * this.volume;
    this.cogs = this.varCost * this.volume + this.fixedMfg;
    this.gross = this.revenue - this.cogs;
    this.op = this.gross - this.ad - this.admin;
    this.pbt = this.op - this.interest;
    this.tax = Math.max(0, this.pbt * this.taxRate);
    this.net = this.pbt - this.tax;
  }

  margins() {
    const r = this.revenue || 1;
    return {
      gm: this.gross / r,
      om: this.op / r,
      nm: this.net / r,
    };
  }
}

// ===== 固定的第 1 期：餐廳版 =====
// 價格 = 平均客單價；銷量 = 當期來客數
function fixedPeriod1() {
  return new Period(
    500,      // 單價：平均每位客人消費 500 元
    3000,     // 來客數：3000 人
    220,      // 每位客人的變動成本（食材 + 部分人事）
    250000,   // 固定成本：房租、水電、基本人事
    50000,    // 行銷費用
    450000,   // 管理及其他費用
    20000     // 利息
  );
}

// ===== 產生第 2 期（餐廳隨機情境） =====
function derivePeriod2(p1) {
  const s = Math.floor(Math.random() * 3) + 1;
  let price, vol, vc, fm, ad, admin;
  let desc = "";

  if (s === 1) {
    // 打折 + 加強廣告 → 人潮變多，但毛利變薄
    desc = "折扣活動 + 增加廣告：人潮變多但毛利率下降";
    price = p1.price * 0.95;
    vol   = p1.volume * 1.20;
    vc    = p1.varCost * 1.05;     // 食材用量增加、浪費提高
    fm    = p1.fixedMfg;
    ad    = p1.ad * 1.4;
    admin = p1.admin * 1.05;
  } else if (s === 2) {
    // 食材上漲、人事成本升高
    desc = "食材上漲 + 人事成本增加：成本壓力加大，獲利惡化";
    price = p1.price * 1.02;
    vol   = p1.volume * 0.97;
    vc    = p1.varCost * 1.15;     // 食材漲價
    fm    = p1.fixedMfg * 1.05;    // 租金或電費上漲
    ad    = p1.ad;
    admin = p1.admin * 1.1;
  } else {
    // 費用控制成功
    desc = "優化人力與控管成本：費用下降，淨利改善";
    price = p1.price * 1.01;
    vol   = p1.volume * 1.02;
    vc    = p1.varCost * 0.98;
    fm    = p1.fixedMfg;
    ad    = p1.ad * 0.9;
    admin = p1.admin * 0.88;
  }

  return {
    period: new Period(price, vol, vc, fm, ad, admin, p1.interest),
    description: desc,
  };
}

// ===== 套用決策（餐廳版需求反應） =====
function applyDecision(p2, d) {
  let price = p2.price;
  let vol   = p2.volume;
  let ad    = p2.ad;
  let admin = p2.admin;
  let vc    = p2.varCost;

  // 1. 價格調整：客人對價格較敏感
  if (d.price === "up") {
    price *= 1.10;  // 漲價 10%
    vol   *= 0.90;  // 來客數 -10%
  } else if (d.price === "down") {
    price *= 0.90;  // 降價 10%
    vol   *= 1.20;  // 來客數 +20%
  }

  // 2. 廣告調整：影響來客數
  if (d.ad === "up") {
    ad  *= 1.20;    // 行銷費 +20%
    vol *= 1.15;    // 來客數 +15%
  } else if (d.ad === "down") {
    ad  *= 0.80;    // 行銷費 -20%
    vol *= 0.90;    // 來客數 -10%
  }

  // 3. 成本改善：談供應商、優化菜單
  if (d.costImprove) {
    vc *= 0.95;      // 變動成本 -5%
    admin += 20000;  // 額外顧問費
  }

  // 4. 精簡管理與人力：省成本但服務變差
  if (d.adminCut) {
    admin *= 0.85;   // 管理費 -15%
    vol   *= 0.85;   // 來客數 -15%
  }

  // 5. 餐廳容量上限（就算很紅也塞不下無限多客人）
  const MAX_CUSTOMERS = 4200;
  if (vol > MAX_CUSTOMERS) vol = MAX_CUSTOMERS;

  return new Period(
    price,
    vol,
    vc,
    p2.fixedMfg,
    ad,
    admin,
    p2.interest
  );
}

// ===== UI：渲染損益表 =====
function renderTable(p, el) {
  if (!p) {
    el.innerHTML = "<tr><td class='muted'>尚無資料</td></tr>";
    return;
  }

  function f(n) {
    return Math.round(n).toLocaleString("zh-TW");
  }
  function r(n) {
    return (n * 100).toFixed(1) + "%";
  }

  const m = p.margins();

  el.innerHTML = `
    <tr><th>項目</th><th>金額</th></tr>
    <tr><td>營業收入（客單價 × 來客數）</td><td>${f(p.revenue)}</td></tr>
    <tr><td>餐飲成本（變動成本 + 固定成本）</td><td>${f(p.cogs)}</td></tr>
    <tr><td>毛利</td><td>${f(p.gross)}</td></tr>
    <tr><td>行銷費用</td><td>${f(p.ad)}</td></tr>
    <tr><td>管理及其他費用</td><td>${f(p.admin)}</td></tr>
    <tr><td>營業利益</td><td>${f(p.op)}</td></tr>
    <tr><td>利息費用</td><td>${f(p.interest)}</td></tr>
    <tr><td>稅前淨利</td><td>${f(p.pbt)}</td></tr>
    <tr><td>所得稅</td><td>${f(p.tax)}</td></tr>
    <tr><td>本期淨利</td><td>${f(p.net)}</td></tr>
    <tr><td>毛利率</td><td>${r(m.gm)}</td></tr>
    <tr><td>營業利益率</td><td>${r(m.om)}</td></tr>
    <tr><td>淨利率</td><td>${r(m.nm)}</td></tr>
  `;
}

// ===== 遊戲流程控制 =====
let p1, p2, p3;

function newCompany() {
  p1 = fixedPeriod1();
  const d2 = derivePeriod2(p1);
  p2 = d2.period;
  p3 = null;

  document.getElementById("p2-tag").textContent = d2.description;
  document.getElementById("p3-tag").textContent = "第 3 期（尚未決策）";

  renderTable(p1, document.getElementById("table-p1"));
  renderTable(p2, document.getElementById("table-p2"));
  renderTable(null, document.getElementById("table-p3"));

  document.getElementById("result").textContent = "尚未執行決策。";
  document.getElementById("metrics").innerHTML = "";
}

function runDecision() {
  const d = {
    price: document.getElementById("sel-price").value,
    ad: document.getElementById("sel-ad").value,
    costImprove: document.getElementById("chk-cost").checked,
    adminCut: document.getElementById("chk-admin").checked,
  };

  p3 = applyDecision(p2, d);
  renderTable(p3, document.getElementById("table-p3"));
  document.getElementById("p3-tag").textContent = "第 3 期（已決策）";

  const rate = (p3.net - p2.net) / Math.abs(p2.net || 1);

  let summary = "";
  if (rate > 0.05) {
    summary = "淨利顯著改善：這次的餐廳經營決策是成功的！";
  } else if (rate < -0.05) {
    summary = "淨利惡化：決策失敗，需要檢討定價、行銷與成本配置。";
  } else {
    summary = "淨利變化不大：影響有限，可以嘗試不同的策略組合。";
  }

  document.getElementById("result").textContent = summary;

  const m3 = p3.margins();
  const m2 = p2.margins();

  document.getElementById("metrics").innerHTML = `
    <div class="metric-tag">營收變化：${(p3.revenue - p2.revenue).toFixed(0)} 元</div>
    <div class="metric-tag">淨利變化：${(p3.net - p2.net).toFixed(0)} 元</div>
    <div class="metric-tag">毛利率：${(m3.gm * 100).toFixed(1)}%（第 2 期：${(m2.gm * 100).toFixed(1)}%）</div>
    <div class="metric-tag">淨利率：${(m3.nm * 100).toFixed(1)}%（第 2 期：${(m2.nm * 100).toFixed(1)}%）</div>
  `;
}

function clearP3() {
  p3 = null;
  renderTable(null, document.getElementById("table-p3"));
  document.getElementById("p3-tag").textContent = "第 3 期（尚未決策）";
  document.getElementById("result").textContent = "尚未執行決策。";
  document.getElementById("metrics").innerHTML = "";
}

// 綁定按鈕
document.getElementById("btn-new").onclick  = newCompany;
document.getElementById("btn-run").onclick  = runDecision;
document.getElementById("btn-clear").onclick = clearP3;

// 初始載入
newCompany();
</script>

</body>
</html>
